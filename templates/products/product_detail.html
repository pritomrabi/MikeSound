{% extends 'base.html' %}
{% load static %}
{% load product_extras %}

{% block content %}
<h2>{{ product.title }}</h2>

<div class="product-images">
    {% for image in product.images.all %}
        <img src="{{ image.image.url }}" alt="{{ product.title }}" width="200" height="200">
    {% endfor %}
</div>

<p><strong>Brand:</strong> {{ product.brand.name }}</p>
<p><strong>Description:</strong> {{ product.description }}</p>

{% if product.sold_count > 0 %}
<p><strong>Sold:</strong> {{ product.sold_count }}</p>
{% endif %}

{% if product.variations.all %}
<form method="post" action="{% url 'add_to_cart' product.id %}">
    {% csrf_token %}
    <label for="variation">Select Variation:</label>
    <select name="variation_id" id="variation">
        {% for var in product.variations.all %}
            {% with price=product|get_discounted_price:var %}
                <option value="{{ var.id }}">
                    {{ var.size }} -
                    {% if var.color %}{{ var.color.name }}{% else %}No Color{% endif %}
                    - ${{ price|floatformat:2 }}
                </option>
            {% endwith %}
        {% endfor %}
    </select>

    <label for="quantity">Quantity:</label>
    <input type="number" name="quantity" value="1" min="1">
    <button type="submit">Add to Cart</button>
</form>
{% else %}
<p>No variations available.</p>
{% endif %}

<p>
    {% if user.is_authenticated %}
        <a href="{% url 'add_to_wishlist' product.id %}">
            {% if user in product.users_wishlist.all %}
                Remove from Wishlist
            {% else %}
                Add to Wishlist
            {% endif %}
        </a> ({{ product.users_wishlist.count }})
    {% else %}
        <a href="{% url 'login' %}?next={{ request.path }}">Login to Wishlist</a>
    {% endif %}
</p>

<p><a href="{% url 'product_list' %}">Back to Product List</a></p>
{% endblock %}
