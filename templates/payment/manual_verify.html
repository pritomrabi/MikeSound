<h2>Verify Manual Payment</h2>

<p><strong>Transaction ID:</strong> {{ txn.id }}</p>
<p><strong>Order ID:</strong> {{ txn.order.id }}</p>
<p><strong>User:</strong> {{ txn.order.user.email }}</p>
<p><strong>Amount:</strong> {{ txn.amount }}</p>
<p><strong>Payment Gateway:</strong> {{ txn.gateway }}</p>
<p><strong>Reference submitted by user:</strong> {{ txn.reference }}</p>
<p><strong>Status:</strong> {{ txn.status }}</p>

<h3>Order Items</h3>
<table border="1" cellpadding="5">
<tr>
<th>Product</th><th>Variation</th><th>Quantity</th><th>Unit Price</th><th>Total</th>
</tr>
{% for item in txn.order.items.all %}
<tr>
<td>{{ item.product.title }}</td>
<td>{% if item.variation %}{{ item.variation.size }}{% else %}Default{% endif %}</td>
<td>{{ item.quantity }}</td>
<td>{{ item.unit_price }}</td>
<td>{{ item.line_total }}</td>
</tr>
{% endfor %}
</table>

<form method="post">
    {% csrf_token %}
    <label>Update Reference (if needed)</label>
    <input type="text" name="reference" value="{{ txn.reference }}">
    <label>Status</label>
    <select name="status">
        <option value="pending" {% if txn.status == 'pending' %}selected{% endif %}>Pending</option>
        <option value="success" {% if txn.status == 'success' %}selected{% endif %}>Success</option>
        <option value="failed" {% if txn.status == 'failed' %}selected{% endif %}>Failed</option>
    </select>
    <button type="submit">Update & Confirm</button>
</form>

<p style="color:red; font-weight:bold;">
Check actual payment in {{ txn.gateway }} using the submitted reference and amount before marking success.
</p>
