<h2>Courier Report</h2>

<form method="get">
    Start Date: <input type="date" name="start_date" value="{{ request.GET.start_date }}">
    End Date: <input type="date" name="end_date" value="{{ request.GET.end_date }}">
    Status: 
    <select name="status">
        <option value="">All</option>
        {% for key, val in couriers.model._meta.get_field('status').choices %}
            <option value="{{ key }}" {% if request.GET.status == key %}selected{% endif %}>{{ val }}</option>
        {% endfor %}
    </select>
    <button type="submit">Filter</button>
</form>

<table border="1">
    <tr>
        <th>Order ID</th>
        <th>Courier</th>
        <th>Status</th>
        <th>Assigned At</th>
        <th>Delivered At</th>
        <th>Delivery Address</th>
        <th>Products</th>
    </tr>
    {% for oc in couriers %}
    <tr>
        <td>{{ oc.order.id }}</td>
        <td>{{ oc.courier.name if oc.courier else '-' }}</td>
        <td>{{ oc.status }}</td>
        <td>{{ oc.assigned_at }}</td>
        <td>{{ oc.delivered_at }}</td>
        <td>
            {% if oc.order.address %}
                {{ oc.order.address.full_name }}<br>
                {{ oc.order.address.phone }}<br>
                {{ oc.order.address.line1 }}, {{ oc.order.address.city }}, {{ oc.order.address.country }}
            {% else %}
                No address
            {% endif %}
        </td>
        <td>
            {% for item in oc.order.items.all %}
                {{ item.product.title }}{% if item.variation %} ({{ item.variation.size }}){% endif %} x {{ item.quantity }}<br>
            {% endfor %}
        </td>
    </tr>
    {% endfor %}
</table>
